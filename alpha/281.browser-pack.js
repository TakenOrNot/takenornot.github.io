"use strict";(self.webpackChunkab2ac=self.webpackChunkab2ac||[]).push([[281],{521:(e,t,i)=>{i.d(t,{o:()=>r});class r{constructor(e,t){this.width=e,this.height=t}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let e=0|this.width;return e=397*e^this.height,e}copyFrom(e){this.width=e.width,this.height=e.height}copyFromFloats(e,t){return this.width=e,this.height=t,this}set(e,t){return this.copyFromFloats(e,t)}multiplyByFloats(e,t){return new r(this.width*e,this.height*t)}clone(){return new r(this.width,this.height)}equals(e){return!!e&&this.width===e.width&&this.height===e.height}get surface(){return this.width*this.height}static Zero(){return new r(0,0)}add(e){return new r(this.width+e.width,this.height+e.height)}subtract(e){return new r(this.width-e.width,this.height-e.height)}scale(e){return new r(this.width*e,this.height*e)}static Lerp(e,t,i){const s=e.width+(t.width-e.width)*i,a=e.height+(t.height-e.height)*i;return new r(s,a)}}},2667:(e,t,i)=>{i.d(t,{t:()=>_});var r=i(5524),s=i(9259),a=i(9848),n=i(9923),h=i(6315),o=i(8688),l=(i(9492),i(521));class u{get wrapU(){return this._wrapU}set wrapU(e){this._wrapU=e}get wrapV(){return this._wrapV}set wrapV(e){this._wrapV=e}get coordinatesMode(){return 0}get isCube(){return!!this._texture&&this._texture.isCube}set isCube(e){this._texture&&(this._texture.isCube=e)}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(e){this._texture&&(this._texture.is3D=e)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(e){this._texture&&(this._texture.is2DArray=e)}getClassName(){return"ThinTexture"}static _IsRenderTargetWrapper(e){return void 0!==e?.shareDepth}constructor(e){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=l.o.Zero(),this._cachedBaseSize=l.o.Zero(),this._initialSamplingMode=2,this._texture=u._IsRenderTargetWrapper(e)?e.texture:e,this._texture&&(this._engine=this._texture.getEngine())}isReady(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady}delayLoad(){}getInternalTexture(){return this._texture}getSize(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}getBaseSize(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)}get samplingMode(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}updateSamplingMode(e){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(e,this._texture,this._texture.generateMipMaps)}releaseInternalTexture(){this._texture&&(this._texture.dispose(),this._texture=null)}dispose(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}}var c=i(6877);class _ extends u{set hasAlpha(e){this._hasAlpha!==e&&(this._hasAlpha=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))))}get hasAlpha(){return this._hasAlpha}set getAlphaFromRGB(e){this._getAlphaFromRGB!==e&&(this._getAlphaFromRGB=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))))}get getAlphaFromRGB(){return this._getAlphaFromRGB}set coordinatesIndex(e){this._coordinatesIndex!==e&&(this._coordinatesIndex=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))))}get coordinatesIndex(){return this._coordinatesIndex}set coordinatesMode(e){this._coordinatesMode!==e&&(this._coordinatesMode=e,this._scene&&this._scene.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))))}get coordinatesMode(){return this._coordinatesMode}get wrapU(){return this._wrapU}set wrapU(e){this._wrapU=e}get wrapV(){return this._wrapV}set wrapV(e){this._wrapV=e}get isCube(){return this._texture?this._texture.isCube:this._isCube}set isCube(e){this._texture?this._texture.isCube=e:this._isCube=e}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(e){this._texture&&(this._texture.is3D=e)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(e){this._texture&&(this._texture.is2DArray=e)}get gammaSpace(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace}set gammaSpace(e){if(this._texture){if(this._texture._gammaSpace===e)return;this._texture._gammaSpace=e}else{if(this._gammaSpace===e)return;this._gammaSpace=e}this.getScene()?.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this)))}get isRGBD(){return null!=this._texture&&this._texture._isRGBD}set isRGBD(e){e!==this.isRGBD&&(this._texture&&(this._texture._isRGBD=e),this.getScene()?.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))))}get noMipmap(){return!1}get lodGenerationOffset(){return this._texture?this._texture._lodGenerationOffset:0}set lodGenerationOffset(e){this._texture&&(this._texture._lodGenerationOffset=e)}get lodGenerationScale(){return this._texture?this._texture._lodGenerationScale:0}set lodGenerationScale(e){this._texture&&(this._texture._lodGenerationScale=e)}get linearSpecularLOD(){return!!this._texture&&this._texture._linearSpecularLOD}set linearSpecularLOD(e){this._texture&&(this._texture._linearSpecularLOD=e)}get irradianceTexture(){return this._texture?this._texture._irradianceTexture:null}set irradianceTexture(e){this._texture&&(this._texture._irradianceTexture=e)}get uid(){return this._uid||(this._uid=(0,o.z)()),this._uid}toString(){return this.name}getClassName(){return"BaseTexture"}set onDispose(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)}get isBlocking(){return!0}get loadingError(){return this._loadingError}get errorObject(){return this._errorObject}constructor(e,t=null){super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=_.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=[],this.onDisposeObservable=new a.Observable,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,e?_._IsScene(e)?this._scene=e:this._engine=e:this._scene=h.q.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=t,this._uid=null}getScene(){return this._scene}_getEngine(){return this._engine}getTextureMatrix(){return n.uq.IdentityReadOnly}getReflectionTextureMatrix(){return n.uq.IdentityReadOnly}getRefractionTextureMatrix(){return this.getReflectionTextureMatrix()}isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError}scale(e){}get canRescale(){return!1}_getFromCache(e,t,i,r,s,a){const n=this._getEngine();if(!n)return null;const h=n._getUseSRGBBuffer(!!s,t),o=n.getLoadedTexturesCache();for(let n=0;n<o.length;n++){const l=o[n];if(!(void 0!==s&&h!==l._useSRGBBuffer||void 0!==r&&r!==l.invertY||l.url!==e||l.generateMipMaps!==!t||i&&i!==l.samplingMode||void 0!==a&&a!==l.isCube))return l.incrementReferences(),l}return null}_rebuild(e=!1){}clone(){return null}get textureType(){return this._texture&&void 0!==this._texture.type?this._texture.type:0}get textureFormat(){return this._texture&&void 0!==this._texture.format?this._texture.format:5}_markAllSubMeshesAsTexturesDirty(){const e=this.getScene();e&&e.markAllMaterialsAsDirty(1)}readPixels(e=0,t=0,i=null,r=!0,s=!1,a=0,n=0,h=Number.MAX_VALUE,o=Number.MAX_VALUE){if(!this._texture)return null;const l=this._getEngine();if(!l)return null;const u=this.getSize();let c=u.width,_=u.height;0!==t&&(c/=Math.pow(2,t),_/=Math.pow(2,t),c=Math.round(c),_=Math.round(_)),h=Math.min(c,h),o=Math.min(_,o);try{return this._texture.isCube?l._readTexturePixels(this._texture,h,o,e,t,i,r,s,a,n):l._readTexturePixels(this._texture,h,o,-1,t,i,r,s,a,n)}catch(e){return null}}_readPixelsSync(e=0,t=0,i=null,r=!0,s=!1){if(!this._texture)return null;const a=this.getSize();let n=a.width,h=a.height;const o=this._getEngine();if(!o)return null;0!=t&&(n/=Math.pow(2,t),h/=Math.pow(2,t),n=Math.round(n),h=Math.round(h));try{return this._texture.isCube?o._readTexturePixelsSync(this._texture,n,h,e,t,i,r,s):o._readTexturePixelsSync(this._texture,n,h,-1,t,i,r,s)}catch(e){return null}}get _lodTextureHigh(){return this._texture?this._texture._lodTextureHigh:null}get _lodTextureMid(){return this._texture?this._texture._lodTextureMid:null}get _lodTextureLow(){return this._texture?this._texture._lodTextureLow:null}dispose(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);const e=this._scene.textures.indexOf(this);if(e>=0&&this._scene.textures.splice(e,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){const e=this._parentContainer.textures.indexOf(this);e>-1&&this._parentContainer.textures.splice(e,1),this._parentContainer=null}}this.onDisposeObservable.notifyObservers(this),this.onDisposeObservable.clear(),this.metadata=null,super.dispose()}serialize(e=!1){if(!this.name&&!e)return null;const t=c.p.Serialize(this);return c.p.AppendSerializedAnimations(this,t),t}static WhenAllReady(e,t){let i=e.length;if(0!==i)for(let r=0;r<e.length;r++){const s=e[r];if(s.isReady())0==--i&&t();else{const e=s.onLoadObservable;e?e.addOnce((()=>{0==--i&&t()})):0==--i&&t()}}else t()}static _IsScene(e){return"Scene"===e.getClassName()}}_.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,r.Cg)([(0,s.lK)()],_.prototype,"uniqueId",void 0),(0,r.Cg)([(0,s.lK)()],_.prototype,"name",void 0),(0,r.Cg)([(0,s.lK)()],_.prototype,"displayName",void 0),(0,r.Cg)([(0,s.lK)()],_.prototype,"metadata",void 0),(0,r.Cg)([(0,s.lK)("hasAlpha")],_.prototype,"_hasAlpha",void 0),(0,r.Cg)([(0,s.lK)("getAlphaFromRGB")],_.prototype,"_getAlphaFromRGB",void 0),(0,r.Cg)([(0,s.lK)()],_.prototype,"level",void 0),(0,r.Cg)([(0,s.lK)("coordinatesIndex")],_.prototype,"_coordinatesIndex",void 0),(0,r.Cg)([(0,s.lK)()],_.prototype,"optimizeUVAllocation",void 0),(0,r.Cg)([(0,s.lK)("coordinatesMode")],_.prototype,"_coordinatesMode",void 0),(0,r.Cg)([(0,s.lK)()],_.prototype,"wrapU",null),(0,r.Cg)([(0,s.lK)()],_.prototype,"wrapV",null),(0,r.Cg)([(0,s.lK)()],_.prototype,"wrapR",void 0),(0,r.Cg)([(0,s.lK)()],_.prototype,"anisotropicFilteringLevel",void 0),(0,r.Cg)([(0,s.lK)()],_.prototype,"isCube",null),(0,r.Cg)([(0,s.lK)()],_.prototype,"is3D",null),(0,r.Cg)([(0,s.lK)()],_.prototype,"is2DArray",null),(0,r.Cg)([(0,s.lK)()],_.prototype,"gammaSpace",null),(0,r.Cg)([(0,s.lK)()],_.prototype,"invertZ",void 0),(0,r.Cg)([(0,s.lK)()],_.prototype,"lodLevelInAlpha",void 0),(0,r.Cg)([(0,s.lK)()],_.prototype,"lodGenerationOffset",null),(0,r.Cg)([(0,s.lK)()],_.prototype,"lodGenerationScale",null),(0,r.Cg)([(0,s.lK)()],_.prototype,"linearSpecularLOD",null),(0,r.Cg)([(0,s.uM)()],_.prototype,"irradianceTexture",null),(0,r.Cg)([(0,s.lK)()],_.prototype,"isRenderTarget",void 0)},4281:(e,t,i)=>{i.d(t,{g:()=>p});var r=i(5524),s=i(9259),a=i(9848),n=i(9923),h=i(2667),o=i(6552),l=i(5503),u=i(2940),c=i(9337),_=i(4100),d=i(6181);function x(e,t,i=!1){const r=t.width,s=t.height;if(e instanceof Float32Array){let t=e.byteLength/e.BYTES_PER_ELEMENT;const i=new Uint8Array(t);for(;--t>=0;){let r=e[t];r<0?r=0:r>1&&(r=1),i[t]=255*r}e=i}const a=document.createElement("canvas");a.width=r,a.height=s;const n=a.getContext("2d");if(!n)return null;const h=n.createImageData(r,s);if(h.data.set(e),n.putImageData(h,0,0),i){const e=document.createElement("canvas");e.width=r,e.height=s;const t=e.getContext("2d");return t?(t.translate(0,s),t.scale(1,-1),t.drawImage(a,0,0),e.toDataURL("image/png")):null}return a.toDataURL("image/png")}var g=i(6877);class p extends h.t{static _CreateVideoTexture(e,t,i,r=!1,s=!1,a=p.TRILINEAR_SAMPLINGMODE,n={},h,o=5){throw(0,l.n)("VideoTexture")}get noMipmap(){return this._noMipmap}get mimeType(){return this._mimeType}set isBlocking(e){this._isBlocking=e}get isBlocking(){return this._isBlocking}get invertY(){return this._invertY}constructor(e,t,i,r,s=p.TRILINEAR_SAMPLINGMODE,n=null,h=null,o=null,l=!1,c,_,d,x,g){let f;super(t),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedIdentity3x2=!0,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new a.Observable,this._isBlocking=!0,this.name=e||"",this.url=e;let m=!1,R=null,M=!0;"object"==typeof i&&null!==i?(f=i.noMipmap??!1,r=i.invertY??!0,s=i.samplingMode??p.TRILINEAR_SAMPLINGMODE,n=i.onLoad??null,h=i.onError??null,o=i.buffer??null,l=i.deleteBuffer??!1,c=i.format,_=i.mimeType,d=i.loaderOptions,x=i.creationFlags,m=i.useSRGBBuffer??!1,R=i.internalTexture??null,M=i.gammaSpace??M,g=i.forcedExtension??g):f=!!i,this._gammaSpace=M,this._noMipmap=f,this._invertY=void 0===r||r,this._initialSamplingMode=s,this._buffer=o,this._deleteBuffer=l,this._mimeType=_,this._loaderOptions=d,this._creationFlags=x,this._useSRGBBuffer=m,this._forcedExtension=g,void 0!==c&&(this._format=c);const T=this.getScene(),S=this._getEngine();if(!S)return;S.onBeforeTextureInitObservable.notifyObservers(this);const A=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),null!==this._texture._cachedWrapU&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),null!==this._texture._cachedWrapV&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),null!==this._texture._cachedWrapR&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),n&&n(),!this.isBlocking&&T&&T.resetCachedMaterial()},y=(e,t)=>{this._loadingError=!0,this._errorObject={message:e,exception:t},h&&h(e,t),p.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!R)return this._delayedOnLoad=A,void(this._delayedOnError=y);if(this._texture=R??this._getFromCache(this.url,f,s,this._invertY,m,this.isCube),this._texture)if(this._texture.isReady)u._.SetImmediate((()=>A()));else{const e=this._texture.onLoadedObservable.add(A);this._texture.onErrorObservable.add((t=>{y(t.message,t.exception),this._texture?.onLoadedObservable.remove(e)}))}else if(T&&T.useDelayedTextureLoading)this.delayLoadState=4,this._delayedOnLoad=A,this._delayedOnError=y;else{try{this._texture=S.createTexture(this.url,f,this._invertY,T,s,A,y,this._buffer,void 0,this._format,this._forcedExtension,_,d,x,m)}catch(e){throw y("error loading",e),e}l&&(this._buffer=null)}}updateURL(e,t=null,i,r){this.url&&(this.releaseInternalTexture(),this.getScene().markAllMaterialsAsDirty(1,(e=>e.hasTexture(this)))),this.name&&!this.name.startsWith("data:")||(this.name=e),this.url=e,this._buffer=t,this._forcedExtension=r,this.delayLoadState=4,i&&(this._delayedOnLoad=i),this.delayLoad()}delayLoad(){if(4!==this.delayLoadState)return;const e=this.getScene();e&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer,this.isCube),this._texture?this._delayedOnLoad&&(this._texture.isReady?u._.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=e.getEngine().createTexture(this.url,this._noMipmap,this._invertY,e,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}_prepareRowForTextureGeneration(e,t,i,r){e*=this._cachedUScale,t*=this._cachedVScale,e-=this.uRotationCenter*this._cachedUScale,t-=this.vRotationCenter*this._cachedVScale,i-=this.wRotationCenter,n.Pq.TransformCoordinatesFromFloatsToRef(e,t,i,this._rowGenerationMatrix,r),r.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,r.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,r.z+=this.wRotationCenter}getTextureMatrix(e=1){if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*e===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*e,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=n.uq.Zero(),this._rowGenerationMatrix=new n.uq,this._t0=n.Pq.Zero(),this._t1=n.Pq.Zero(),this._t2=n.Pq.Zero()),n.uq.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(n.uq.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,n.AA.Matrix[0]),n.uq.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,n.AA.Matrix[1]),n.uq.ScalingToRef(this._cachedUScale,this._cachedVScale,0,n.AA.Matrix[2]),n.uq.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,n.AA.Matrix[3]),n.AA.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(n.AA.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(n.AA.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(n.AA.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.subtractInPlace(this._t0),this._t2.subtractInPlace(this._t0),n.uq.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));const t=this.getScene();if(!t)return this._cachedTextureMatrix;const i=this._cachedIdentity3x2;return this._cachedIdentity3x2=this._cachedTextureMatrix.isIdentityAs3x2(),this.optimizeUVAllocation&&i!==this._cachedIdentity3x2&&t.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))),this._cachedTextureMatrix}getReflectionTextureMatrix(){const e=this.getScene();if(!e)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode){if(this.coordinatesMode!==p.PROJECTION_MODE)return this._cachedReflectionTextureMatrix;if(this._cachedReflectionProjectionMatrixId===e.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=n.uq.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=n.uq.Zero());const t=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case p.PLANAR_MODE:n.uq.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break;case p.PROJECTION_MODE:{n.uq.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);const t=e.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=t.updateFlag,t.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:n.uq.IdentityToRef(this._cachedReflectionTextureMatrix)}return t&&e.markAllMaterialsAsDirty(1,(e=>e.hasTexture(this))),this._cachedReflectionTextureMatrix}clone(){const e={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,onLoad:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return g.p.Clone((()=>new p(this._texture?this._texture.url:null,this.getScene(),e)),this)}serialize(){const e=this.name;p.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");const t=super.serialize(p._SerializeInternalTextureUniqueId);if(!t)return null;if(p.SerializeBuffers||p.ForceSerializeBuffers)if("string"==typeof this._buffer&&this._buffer.startsWith("data:"))t.base64String=this._buffer,t.name=t.name.replace("data:","");else if(this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array){const e=this.mimeType||"image/png";t.base64String=`data:${e};base64,${(0,d.EL)(this._buffer)}`}else(p.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(t.base64String=!this._engine||this._engine._features.supportSyncTextureRead?function(e,t=0,i=0){const r=e.getInternalTexture();if(!r)return null;const s=e._readPixelsSync(t,i);return s?x(s,e.getSize(),r.invertY):null}(this):async function(e,t=0,i=0){const r=e.getInternalTexture();if(!r)return null;const s=await e.readPixels(t,i);return s?x(s,e.getSize(),r.invertY):null}(this));return t.invertY=this._invertY,t.samplingMode=this.samplingMode,t._creationFlags=this._creationFlags,t._useSRGBBuffer=this._useSRGBBuffer,p._SerializeInternalTextureUniqueId&&(t.internalTextureUniqueId=this._texture?.uniqueId),t.internalTextureLabel=this._texture?.label,t.noMipmap=this._noMipmap,this.name=e,t}getClassName(){return"Texture"}dispose(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}static Parse(e,t,i){if(e.customType){const r=c.n.Instantiate(e.customType).Parse(e,t,i);return e.samplingMode&&r.updateSamplingMode&&r._samplingMode&&r._samplingMode!==e.samplingMode&&r.updateSamplingMode(e.samplingMode),r}if(e.isCube&&!e.isRenderTarget)return p._CubeTextureParser(e,t,i);const r=void 0!==e.internalTextureUniqueId;if(!e.name&&!e.isRenderTarget&&!r)return null;let s;if(r){const i=t.getEngine().getLoadedTexturesCache();for(const t of i)if(t.uniqueId===e.internalTextureUniqueId){s=t;break}}const a=t=>{if(t&&t._texture&&(t._texture._cachedWrapU=null,t._texture._cachedWrapV=null,t._texture._cachedWrapR=null),e.samplingMode){const i=e.samplingMode;t&&t.samplingMode!==i&&t.updateSamplingMode(i)}if(t&&e.animations)for(let i=0;i<e.animations.length;i++){const r=e.animations[i],s=(0,o.n9)("BABYLON.Animation");s&&t.animations.push(s.Parse(r))}t&&t._texture&&(r&&!s&&t._texture._setUniqueId(e.internalTextureUniqueId),t._texture.label=e.internalTextureLabel)};return g.p.Parse((()=>{let r=!0;if(e.noMipmap&&(r=!1),e.mirrorPlane){const i=p._CreateMirror(e.name,e.renderTargetSize,t,r);return i._waitingRenderList=e.renderList,i.mirrorPlane=_.Z.FromArray(e.mirrorPlane),a(i),i}if(e.isRenderTarget){let i=null;if(e.isCube){if(t.reflectionProbes)for(let i=0;i<t.reflectionProbes.length;i++){const r=t.reflectionProbes[i];if(r.name===e.name)return r.cubeTexture}}else i=p._CreateRenderTargetTexture(e.name,e.renderTargetSize,t,r,e._creationFlags??0),i._waitingRenderList=e.renderList;return a(i),i}if(e.isVideo){const s=p._CreateVideoTexture(i+(e.url||e.name),i+(e.src||e.url),t,r,e.invertY,e.samplingMode,e.settings||{});return a(s),s}{let n;if(e.base64String&&!s)n=p.CreateFromBase64String(e.base64String,e.base64String,t,!r,e.invertY,e.samplingMode,(()=>{a(n)}),e._creationFlags??0,e._useSRGBBuffer??!1),n.name=e.name;else{let h;h=e.name&&(e.name.indexOf("://")>0||e.name.startsWith("data:"))?e.name:i+e.name,e.url&&(e.url.startsWith("data:")||p.UseSerializedUrlIfAny)&&(h=e.url);const o={noMipmap:!r,invertY:e.invertY,samplingMode:e.samplingMode,onLoad:()=>{a(n)},internalTexture:s};n=new p(h,t,o)}return n}}),e,t)}static CreateFromBase64String(e,t,i,r,s,a=p.TRILINEAR_SAMPLINGMODE,n=null,h=null,o=5,l,u){return new p("data:"+t,i,r,s,a,n,h,e,!1,o,void 0,void 0,l,u)}static LoadFromDataString(e,t,i,r=!1,s,a=!0,n=p.TRILINEAR_SAMPLINGMODE,h=null,o=null,l=5,u,c){return"data:"!==e.substring(0,5)&&(e="data:"+e),new p(e,i,s,a,n,h,o,t,r,l,void 0,void 0,u,c)}}p.SerializeBuffers=!0,p.ForceSerializeBuffers=!1,p.OnTextureLoadErrorObservable=new a.Observable,p._SerializeInternalTextureUniqueId=!1,p._CubeTextureParser=(e,t,i)=>{throw(0,l.n)("CubeTexture")},p._CreateMirror=(e,t,i,r)=>{throw(0,l.n)("MirrorTexture")},p._CreateRenderTargetTexture=(e,t,i,r,s)=>{throw(0,l.n)("RenderTargetTexture")},p.NEAREST_SAMPLINGMODE=1,p.NEAREST_NEAREST_MIPLINEAR=8,p.BILINEAR_SAMPLINGMODE=2,p.LINEAR_LINEAR_MIPNEAREST=11,p.TRILINEAR_SAMPLINGMODE=3,p.LINEAR_LINEAR_MIPLINEAR=3,p.NEAREST_NEAREST_MIPNEAREST=4,p.NEAREST_LINEAR_MIPNEAREST=5,p.NEAREST_LINEAR_MIPLINEAR=6,p.NEAREST_LINEAR=7,p.NEAREST_NEAREST=1,p.LINEAR_NEAREST_MIPNEAREST=9,p.LINEAR_NEAREST_MIPLINEAR=10,p.LINEAR_LINEAR=2,p.LINEAR_NEAREST=12,p.EXPLICIT_MODE=0,p.SPHERICAL_MODE=1,p.PLANAR_MODE=2,p.CUBIC_MODE=3,p.PROJECTION_MODE=4,p.SKYBOX_MODE=5,p.INVCUBIC_MODE=6,p.EQUIRECTANGULAR_MODE=7,p.FIXED_EQUIRECTANGULAR_MODE=8,p.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,p.CLAMP_ADDRESSMODE=0,p.WRAP_ADDRESSMODE=1,p.MIRROR_ADDRESSMODE=2,p.UseSerializedUrlIfAny=!1,(0,r.Cg)([(0,s.lK)()],p.prototype,"url",void 0),(0,r.Cg)([(0,s.lK)()],p.prototype,"uOffset",void 0),(0,r.Cg)([(0,s.lK)()],p.prototype,"vOffset",void 0),(0,r.Cg)([(0,s.lK)()],p.prototype,"uScale",void 0),(0,r.Cg)([(0,s.lK)()],p.prototype,"vScale",void 0),(0,r.Cg)([(0,s.lK)()],p.prototype,"uAng",void 0),(0,r.Cg)([(0,s.lK)()],p.prototype,"vAng",void 0),(0,r.Cg)([(0,s.lK)()],p.prototype,"wAng",void 0),(0,r.Cg)([(0,s.lK)()],p.prototype,"uRotationCenter",void 0),(0,r.Cg)([(0,s.lK)()],p.prototype,"vRotationCenter",void 0),(0,r.Cg)([(0,s.lK)()],p.prototype,"wRotationCenter",void 0),(0,r.Cg)([(0,s.lK)()],p.prototype,"homogeneousRotationInUVTransform",void 0),(0,r.Cg)([(0,s.lK)()],p.prototype,"isBlocking",null),(0,o.Y5)("BABYLON.Texture",p),g.p._TextureParser=p.Parse}}]);